# common ================================================================== {{{
[tasks.common]
    deps = ["submodules"]
    links = [
        [".config/fish"],
        [".config/terminal"],
        [".config/tmux"],
        [".global_gitignore"],
        [".gnupg"],
        [".hammerspoon"],
        [".mytop"],
        [".psqlrc"],
        [".tmux.conf"],
        [".vim"],
        [".vimrc"],
    ]
    templates = [
        [".gitconfig"]
    ]

[tasks.submodules]
    cmds = [
        ["git", "submodule", "update", "--init", "--remote"],
    ]

[tasks.pip]
    accepts = [["which", "pip3"]]
    cmds = [
        ["pip3", "install", "vim-vint", "gmail-yaml-filters"],
    ]

[tasks.fishinstalled]
    rejects = [["which", "fish"]]
    cmds = [["@install", "fish"]]

[tasks.fish]
    deps = ["fishinstalled"]
    rejects = [["echo", "$SHELL", "|", "grep", "fish"]]
    cmds = [["chsh", "-s", "/usr/bin/fish"]]

# ========================================================================= }}}
# meta ==================================================================== {{{
[tasks.default]
    deps = ["common", "bininstall", "systemconfig", "pip", "fish"]
# ========================================================================= }}}
# macOS =================================================================== {{{
[tasks.installbrew__macos]
    rejects = [["which", "brew"]]
    cmds = [
        ["/usr/bin/ruby", "-e", '"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"'],
        ["brew", "update"],
    ]

[tasks.bininstall__macos]
    deps = ["installbrew"]
    cmds = [
        ["brew", "bundle", "install", "--file=$HM_SRC/../Brewfile"],
        ["brew", "cleanup"],
    ]

[tasks.systemconfig__macos]
    cmds = [
        ["./Darwin/defaults.sh"],
    ]

[macros.install__macos]
    deps = ["installbrew"]
    prefix = ["brew", "install"]

# ========================================================================= }}}
